(this.webpackJsonpschematize=this.webpackJsonpschematize||[]).push([[0],{101:function(e,t,n){"use strict";n.r(t);var o=n(0),r=n.n(o),s=n(22),i=n.n(s),a=(n(49),n(17)),l=n(16),c=n(7),p=n(9),u=n(11),h=n(10),d=n(8),m=n(12),g=n(15),f=(n(95),n(1)),v=n(31),y=n.n(v),b=n(42);function k(e){if(""===e)return!1;var t=new XMLHttpRequest;return t.open("HEAD",e,!1),t.send(),404!==t.status}function x(){return(x=Object(b.a)(y.a.mark((function e(t,n){var o;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(o=new XMLHttpRequest).onreadystatechange=function(){4===o.readyState&&200===o.status&&n(o.responseText)},e.next=4,o.open("GET",t,!0);case 4:o.send(null);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var C=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(u.a)(this,Object(h.a)(t).call(this,e))).pathNames=[],n.components=[],n.jsonCache={},n.nucleotides=[],n.loadIndexFile(n.props.store.jsonName),Object(f.observe)(n.props.store,"jsonName",(function(){n.loadIndexFile(n.props.store.jsonName)})),Object(f.observe)(n.props.store.chunkFastaURLs,(function(){n.loadFasta()})),n}return Object(m.a)(t,e),Object(p.a)(t,[{key:"componentDidUpdate",value:function(){}},{key:"loadIndexFile",value:function(e){var t=this;console.log("STEP #1: whenever jsonName changes, loadIndexFile");var n="https://collections.lugli.arvadosapi.com/c=lugli-4zz18-urirmr577incm1c/t=2xdu3hljzjkir9dnfn14eyreo6fvfngcihxon7ol8h0r3cc5ot/_/"+e+"/bin2file.json";return console.log("loadIndexFile - START reading",n),fetch(n).then((function(e){return e.json()})).then((function(e){console.log("loadIndexFile - END reading",n),t.props.store.setChunkIndex(e)}))}},{key:"jsonFetch",value:function(e){if(!e)throw new Error("No filepath given. Ensure chunknames in bin2file.json are correct.");return console.log("Fetching",e),fetch(e).then((function(e){return e.json()}))}},{key:"loadJsonCache",value:function(e,t){if(console.log("STEP #6: fetched chunks go into loadJsonCache"),15!==t.json_version)throw MediaError("Wrong Data JSON version: was expecting version 15, got "+t.json_version+".  This version switched to sparse JSON.  Using a mismatched data file and renderer will cause unpredictable behavior, instead generate a new data file using github.com/graph-genome/component_segmentation.");this.jsonCache[e]=t,this.pathNames=t.path_names,this.processArray()}},{key:"loadFasta",value:function(){var e=this;console.log("loadFasta"),this.nucleotides=[];var t=!0,n=!1,o=void 0;try{for(var r,s=function(){var t=r.value;k(t)&&(console.log("loadFasta - START: ",t),fetch(t).then((function(e){return e.text()})).then((function(n){var o,r=n.replace(/.*/,"").substr(1).replace(/[\r\n]+/gm,"");(o=e.nucleotides).push.apply(o,Object(a.a)(r)),console.log("loadFasta - END: ",t)})))},i=this.props.store.chunkFastaURLs[Symbol.iterator]();!(t=(r=i.next()).done);t=!0)s()}catch(l){n=!0,o=l}finally{try{t||null==i.return||i.return()}finally{if(n)throw o}}}},{key:"processArray",value:function(){console.log("STEP #7: JsonCache causes processArray to update chunksProcessed");var e=this.props.store,t=[e.getBeginBin(),e.getEndBin()],n=t[0],o=t[1];0!==e.chunksProcessed.length&&e.chunksProcessed[0]===this.props.store.chunkURLs[0]||(this.components=[]),console.log("processArray - parsing components ",n," - ",o);for(var r=0;r<e.chunkURLs.length;r++)if(r>=e.chunksProcessed.length){if(!(e.chunkURLs[r]in this.jsonCache))return!1;var s=e.chunkURLs[r],i=this.jsonCache[s];console.log("processArray - jsonChunk.components[0].x: "+i.components[0].x),0===r&&(e.setBeginColumnX(i.components[0].x),console.log("processArray - jsonChunk.first_bin: "+i.first_bin),e.setChunkBeginBin(i.first_bin));var a=!0,c=!1,p=void 0;try{for(var u,h=i.components.entries()[Symbol.iterator]();!(a=(u=h.next()).done);a=!0){var d=u.value,m=Object(l.a)(d,2),g=m[0],f=m[1];if(f.first_bin>0){var v=new O(f,g);this.components.push(v)}}}catch(y){c=!0,p=y}finally{try{a||null==h.return||h.return()}finally{if(c)throw p}}e.addChunkProcessed(s)}return console.log("processArray",e.chunksProcessed[0],e.chunksProcessed.slice(-1)[0],"out of",this.props.store.chunkURLs.length,"chunks"),!0}}]),t}(r.a.Component),O=function e(t,n){Object(c.a)(this,e),this.columnX=t.x,this.index=n,this.firstBin=t.first_bin,this.lastBin=t.last_bin,this.arrivals=[];var o=!0,r=!1,s=void 0;try{for(var i,a=t.arrivals[Symbol.iterator]();!(o=(i=a.next()).done);o=!0){var l=i.value;this.arrivals.push(new w(l))}}catch(f){r=!0,s=f}finally{try{o||null==a.return||a.return()}finally{if(r)throw s}}this.departures=[];var p=!0,u=!1,h=void 0;try{for(var d,m=t.departures[Symbol.iterator]();!(p=(d=m.next()).done);p=!0){var g=d.value;this.departures.push(new w(g))}}catch(f){u=!0,h=f}finally{try{p||null==m.return||m.return()}finally{if(u)throw h}}this.relativePixelX=t.x,this.occupants=t.occupants,this.matrix=t.matrix,this.num_bin=this.lastBin-this.firstBin+1},w=function(){function e(t){Object(c.a)(this,e),this.upstream=t.upstream,this.downstream=t.downstream,this.participants=t.participants,this.key=this.edgeToKey()}return Object(p.a)(e,[{key:"edgeToKey",value:function(){return String(this.downstream).padStart(13,"0")+String(this.upstream).padStart(13,"0")}}]),e}(),j=C,S=function(e){function t(){var e,n;Object(c.a)(this,t);for(var o=arguments.length,r=new Array(o),s=0;s<o;s++)r[s]=arguments[s];return(n=Object(u.a)(this,(e=Object(h.a)(t)).call.apply(e,[this].concat(r)))).state={color:n.props.color},n}return Object(m.a)(t,e),Object(p.a)(t,[{key:"render",value:function(){return r.a.createElement(g.Rect,{x:this.props.x,y:this.props.y,width:this.props.width,height:this.props.height||1,fill:this.state.color})}}]),t}(r.a.Component),E=function(e){function t(){return Object(c.a)(this,t),Object(u.a)(this,Object(h.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(p.a)(t,[{key:"onHover",value:function(){var e='"';e+=this.props.pathName+'"\nCoverage: '+this.props.item[0]+"\nInversion: "+this.props.item[1]+"\nPos: ";for(var t=this.props.item[2],n=0;n<t.length;n++){var o=t[n][0],r=t[n][1];e+=0===n?o+"-"+r:","+o+"-"+r}this.props.store.updateCellTooltipContent(e)}},{key:"onLeave",value:function(){this.props.store.updateCellTooltipContent("")}},{key:"inversionText",value:function(e){return this.props.store.pixelsPerRow>9&&e?r.a.createElement(g.Text,{x:this.props.x,y:this.props.y,width:this.props.width,height:this.props.height||1,align:"center",verticalAlign:"center",text:e?"<":" ",onMouseEnter:this.onHover.bind(this),onMouseLeave:this.onLeave.bind(this)}):null}},{key:"render",value:function(){var e=this.props.item[1]>.5,t="#838383";return e&&(t="#DE4B39"),this.props.item[0]>1&&(t="#6A6A6A"),r.a.createElement(r.a.Fragment,null,r.a.createElement(g.Rect,{x:this.props.x,y:this.props.y,width:this.props.width,height:this.props.height||1,fill:t,onMouseEnter:this.onHover.bind(this),onMouseLeave:this.onLeave.bind(this)}),this.inversionText(e))}}]),t}(r.a.Component);function L(e,t){return e+t}function P(e,t){return 0===e.length&&0===t.length||e.length===t.length&&e.every((function(e){return t.indexOf(e)>-1}))}function N(e,t,n){var o=n||t,r=(e.downstream+1)*(e.upstream+1);if(o){var s=(o.downstream+1)*(o.upstream+1);return!t&&!n||r===s?[R(r),1,t||n?"black":null]:["gray",.3,null]}return[R(r),1,null]}function R(e){e=e.toString();for(var t=0,n=0;n<e.length;n++)t=e.charCodeAt(n)+((t<<5)-t);for(var o="#",r=0;r<3;r++){o+=("00"+(t>>8*r&255).toString(16)).substr(-2)}return o}var _=function(e){function t(){var e,n;Object(c.a)(this,t);for(var o=arguments.length,r=new Array(o),s=0;s<o;s++)r[s]=arguments[s];return(n=Object(u.a)(this,(e=Object(h.a)(t)).call.apply(e,[this].concat(r)))).state={color:"lightgray"},n.handleClick=function(){"lightgray"===n.state.color?n.setState({color:"lightblue"}):"lightblue"===n.state.color&&n.setState({color:"lightgray"})},n}return Object(m.a)(t,e),Object(p.a)(t,[{key:"renderMatrix",value:function(){var e=this,t=this.props.item.matrix.map((function(t,n){var o=t[0];return e.renderMatrixRow(t[1],n,o)}));return this.props.store.updateMaxHeight(this.props.item.occupants.length),r.a.createElement(r.a.Fragment,null,t)}},{key:"renderMatrixRow",value:function(e,t,n){var o=this,s=e[1],i=this.props.item,a=e[0].map((function(e){return e*o.props.store.pixelsPerColumn})),l=i.relativePixelX+i.arrivals.length*this.props.store.pixelsPerColumn,c=1*this.props.store.pixelsPerColumn,p=t;if(!this.props.store.useVerticalCompression){if(!this.props.compressed_row_mapping.hasOwnProperty(n))return null;p=this.props.compressed_row_mapping[n]}return s.map((function(e,t){return e.length?r.a.createElement(r.a.Fragment,null,r.a.createElement(E,{key:"occupant"+n+t,item:e,store:o.props.store,pathName:o.props.pathNames[n],x:l+a[t],y:p*o.props.store.pixelsPerRow+o.props.store.topOffset,row_number:n,width:c,height:o.props.store.pixelsPerRow})):null}))}},{key:"renderAllConnectors",value:function(){var e=this,t=this.props.item.departures,n=t.slice(-1)[0];if(void 0!==n){var o=t.slice(0,-1).map((function(e){return e.participants.length})).reduce(L,0);return r.a.createElement(r.a.Fragment,null,n.participants.map((function(t){return o++,e.renderComponentConnector(o,t)})))}return null}},{key:"renderComponentConnector",value:function(e,t){var n=this.props.item,o=n.relativePixelX+(n.arrivals.length+(this.props.store.useWidthCompression?this.props.store.binScalingFactor:n.num_bin)+n.departures.length-1)*this.props.store.pixelsPerColumn,s=e;return this.props.store.useVerticalCompression||(s=this.props.compressed_row_mapping[t]),r.a.createElement(S,{key:"connector"+t,x:o,y:this.props.store.topOffset+s*this.props.store.pixelsPerRow,width:this.props.store.pixelsPerColumn,height:this.props.store.pixelsPerRow,color:"#464646"})}},{key:"render",value:function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement(g.Rect,{x:this.props.item.relativePixelX,y:this.props.store.topOffset,key:this.state.key+"R",width:this.props.widthInColumns*this.props.store.pixelsPerColumn,height:this.props.height-2,fill:this.state.color,onClick:this.handleClick}),this.props.store.useWidthCompression?null:this.renderMatrix(),this.props.store.useConnector?this.renderAllConnectors():null)}}]),t}(r.a.Component),B=function(e){function t(){return Object(c.a)(this,t),Object(u.a)(this,Object(h.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(p.a)(t,[{key:"renderMatrixRow",value:function(){for(var e=this.props.item,t=e.relativePixelX+e.arrivals.length*this.props.store.pixelsPerColumn,n=[],o=0;o<this.props.item.num_bin;o++)n.push(r.a.createElement(g.Text,{key:"nuc_text"+o,x:t+o*this.props.store.pixelsPerColumn,y:this.props.store.topOffset-this.props.store.nucleotideHeight,text:this.props.nucleotides[o],align:"center",height:this.props.store.nucleotideHeight,width:this.props.store.pixelsPerColumn}));return n}},{key:"render",value:function(){return this.renderMatrixRow()}}]),t}(r.a.Component),M=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(u.a)(this,Object(h.a)(t).call(this,e))).handleMouseOut=n.handleMouseOut.bind(Object(d.a)(n)),n.handleMouseOver=n.handleMouseOver.bind(Object(d.a)(n)),n}return Object(m.a)(t,e),Object(p.a)(t,[{key:"handleMouseOver",value:function(){this.props.updateHighlightedNode(this.props.item)}},{key:"handleMouseOut",value:function(){this.props.updateHighlightedNode(null)}},{key:"linkCells",value:function(){var e,t,n=this;return this.props.store.useVerticalCompression?(e=0,t=this.props.item.participants.length,Object(a.a)(Array(1+t-e).keys()).map((function(t){return e+t}))).map((function(e){return e*n.props.store.pixelsPerRow})):this.props.item.participants.map((function(e){return n.props.compressed_row_mapping[e]*n.props.store.pixelsPerRow}))}},{key:"componentDidMount",value:function(){this.setState({color:this.props.color})}},{key:"render",value:function(){var e=this,t=this.linkCells();return r.a.createElement(r.a.Fragment,null,t.map((function(t,n){return r.a.createElement(g.Rect,{key:"dot"+n,x:e.props.x,y:e.props.store.topOffset+t,width:e.props.store.pixelsPerColumn,height:e.props.store.pixelsPerRow,fill:e.props.color,opacity:e.props.opacity,stroke:e.props.stroke,onMouseOver:e.handleMouseOver,onMouseOut:e.handleMouseOut})})))}}]),t}(r.a.Component);function F(e){return!Number.isFinite(e)}var A=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(u.a)(this,Object(h.a)(t).call(this,e))).handleMouseOver=function(){n.props.updateHighlightedNode(n.props.link.linkColumn)},n.handleMouseOut=function(){n.props.updateHighlightedNode(null)},n.handleClick=function(e){console.log("Click",e,n.props.link);var t=Object(l.a)(n.props.store.beginEndBin,2),o=t[0],r=t[1],s=Object(l.a)(n.props.store.beginEndBin,2),i=s[0],a=s[1],c=a-i,p=i+c/2,u=Math.abs(n.props.link.linkColumn.upstream-p)<Math.abs(n.props.link.linkColumn.downstream-p)?n.props.link.linkColumn.downstream:n.props.link.linkColumn.upstream;u>=i&&u<=a||(r=(o=Math.max(1,~~(u-c/2)))+c),n.props.updateSelectedLink(n.props.link.linkColumn,o,r)},n.arrowXCoord=null,n.points=[],n.handleMouseOut=n.handleMouseOut.bind(Object(d.a)(n)),n.handleMouseOver=n.handleMouseOver.bind(Object(d.a)(n)),n}return Object(m.a)(t,e),Object(p.a)(t,[{key:"componentDidUpdate",value:function(){}},{key:"calculatePoints",value:function(){var e=this.props.link;this.arrowXCoord=this.props.link.xArrival;var t=this.props.link.xDepart-this.arrowXCoord+this.props.store.pixelsPerColumn/2,n=this.props.store.pixelsPerColumn/2,o=t<0?-1:1,r=[t,this.props.store.pixelsPerColumn-2],s=[t-o,2-e.elevation],i=[t-6*o,-e.elevation],a=[n+6*o,-e.elevation],l=[n+o,2-e.elevation],c=[n,-5];this.points=[r[0],r[1],s[0],s[1],i[0],i[1],a[0],a[1],l[0],l[1],c[0],c[1],n,-1],Math.abs(t)<=this.props.store.pixelsPerColumn&&(e.isArrival?this.points=[n,-10,n,-2]:this.points=[r[0],-2+this.props.store.pixelsPerColumn,r[0],-5]),(this.points.some(isNaN)||this.points.some(F))&&console.log("Some points are NaN: "+this.points)}},{key:"render",value:function(){return this.calculatePoints(),r.a.createElement(g.Arrow,{x:this.arrowXCoord,y:this.props.store.topOffset-10,width:this.props.store.pixelsPerColumn,points:this.points,bezier:!1,strokeWidth:this.props.store.pixelsPerColumn,fill:this.props.color,stroke:this.props.color,opacity:this.props.opacity,"stroke-opacity":this.props.opacity,pointerLength:1,pointerWidth:1,tension:1/3,onMouseOver:this.handleMouseOver,onMouseOut:this.handleMouseOut,onClick:this.handleClick})}}]),t}(r.a.Component),T=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3?arguments[3]:void 0;Object(c.a)(this,e),this.linkColumn=t,void 0===t&&console.log(t,n,o),this.xArrival=n,this.xDepart=o,this.elevation=10,this.isArrival=r}return Object(p.a)(e,[{key:"distance",value:function(){return Math.abs(this.xDepart-this.xArrival)||1}}]),e}();function H(e,t,n,o,r,s){for(var i={},l=0;l<e.length;l++){for(var c=e[l],p=0;p<c.arrivals.length;p++){var u=c.arrivals[p],h=s(c,l,0,p),d=u.key;d in i?i[d].xArrival=h:i[d]=new T(u,h,h,!0)}for(var m=0;m<c.departures.length-1;m++){var g=c.departures[m],f=s(c,l,c.arrivals.length+(o?r:c.num_bin),m),v=g.key;v in i?i[v].xDepart=f:i[v]=new T(g,f,f,!1)}}return function(e,t,n){var o=Object.values(e).sort((function(e,t){return e.distance()-t.distance()})),r=function(e,t,n){var o=Math.max.apply(Math,[0].concat(Object(a.a)(e.map((function(e){return Math.max(e.xDepart,e.xArrival)}))))),r=new Array(o).fill(15),s=!0,i=!1,l=void 0;try{for(var c,p=e[Symbol.iterator]();!(s=(c=p.next()).done);s=!0){var u=c.value,h=Math.max(0,Math.min(u.xArrival,u.xDepart)),d=Math.max(u.xArrival,u.xDepart,h+1),m=r.slice(h,d+1),g=m.length?Math.max.apply(Math,Object(a.a)(m)):10;!isNaN(g)&&Number.isFinite(g)||console.log("Bad elevation",u,h,d,m,r);g+=t;for(var f=h;f<d&&f<r.length;f++)r[f]=g;u.elevation=g}}catch(v){i=!0,l=v}finally{try{s||null==p.return||p.return()}finally{if(i)throw l}}return r}(o,t),s=Math.max.apply(Math,Object(a.a)(r))+3*t;return[o,s]}(i,t)}var I=n(43),U=n(18),X=function(e){function t(){return Object(c.a)(this,t),Object(u.a)(this,Object(h.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(p.a)(t,[{key:"render",value:function(){var e=this;return r.a.createElement(I.a,{visible:!0,offsetX:15,offsetY:-20,style:{background:"white",zIndex:4,whiteSpace:"pre-line"}},r.a.createElement(U.a,null,(function(){return r.a.createElement("span",null,e.props.store.cellToolTipContent)})))}}]),t}(r.a.Component),W=function(e){function t(){return Object(c.a)(this,t),Object(u.a)(this,Object(h.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(p.a)(t,[{key:"shift",value:function(e){var t=this.props.store.getBeginBin(),n=this.props.store.getEndBin(),o=n-t,r=Math.floor(o*(e/100));console.log(n+"-"+t+"="+o+" --\x3e diff: "+r),this.props.store.updateBeginEndBin(t+r,n+r)}},{key:"handleJump",value:function(){console.log("JUMP: path name: "+this.props.store.pathNucPos.path+" nucleotide position: "+this.props.store.pathNucPos.nucPos);var e=this.props.store;!function(e,t){x.apply(this,arguments)}(e.pathIndexServerAddress+e.pathNucPos.path+"/"+e.pathNucPos.nucPos,(function(t){if("0"===t)alert("The jump query returned 0. Either your path does not exist or your position in the path is wrong. Please try again.");else{console.log(t),t=parseInt(t);var n=Math.ceil(t/this.props.store.getBinWidth());console.log(n),e.updateBeginEndBin(n,e.getEndBin())}}))}},{key:"change_zoom_level",value:function(e){console.log("change_zoom_level: "+e.value+" ---"+e.options[e.selectedIndex].text),this.props.store.setIndexSelectedZoomLevel(parseInt(e.value))}},{key:"decIndexSelectedZoomLevel",value:function(){var e=this.props.store.indexSelectedZoomLevel;e>0&&this.props.store.setIndexSelectedZoomLevel(e-1)}},{key:"incIndexSelectedZoomLevel",value:function(){var e=this.props.store.indexSelectedZoomLevel;e<this.props.store.availableZoomLevels.length-1&&this.props.store.setIndexSelectedZoomLevel(e+1)}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{id:"button-container"},r.a.createElement("button",{className:"button",id:"btn-download"},"Save Image"),r.a.createElement("input",{type:"text",defaultValue:this.props.store.jsonName,style:{width:"330px"},onChange:this.props.store.tryJSONpath,title:"File:"}),r.a.createElement("span",{style:{marginLeft:"30px"}},r.a.createElement(U.a,null,(function(){return r.a.createElement(r.a.Fragment,null,"Bin width:",r.a.createElement("button",{className:"button",onClick:function(){return e.decIndexSelectedZoomLevel()}},"-"),r.a.createElement("select",{id:"select_bin_width",onChange:function(t){return e.change_zoom_level(t.target)},value:e.props.store.indexSelectedZoomLevel},e.props.store.availableZoomLevels.map((function(e,t){return r.a.createElement("option",{key:t,value:t},e)}))),r.a.createElement("button",{className:"button",onClick:function(){return e.incIndexSelectedZoomLevel()}},"+"))}))),r.a.createElement("span",{style:{marginLeft:"30px"}},r.a.createElement("button",{className:"button",onClick:function(){return e.shift(-100)}},"<<"),r.a.createElement("button",{className:"button",onClick:function(){return e.shift(-50)}},"<"),"Pangenome Bin Position:",r.a.createElement(U.a,null,(function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement("input",{type:"number",value:e.props.store.beginEndBin[0],onChange:function(t){return e.props.store.updateBeginEndBin(t.target.value,e.props.store.getEndBin())},style:{width:"80px"}}),"-",r.a.createElement("input",{type:"number",value:e.props.store.beginEndBin[1],readOnly:!0,style:{width:"80px"}}))})),r.a.createElement("button",{className:"button",onClick:function(){return e.shift(50)}},">"),r.a.createElement("button",{className:"button",onClick:function(){return e.shift(100)}},">>")),r.a.createElement("div",{className:"row"},"Jump to path at nucleotide position:",r.a.createElement("input",{type:"string",list:"path",placeholder:"path",onChange:function(t){return e.props.store.updatePathNucPos(t.target.value,e.props.store.pathNucPos.nucPos)},style:{width:"80px"}}),r.a.createElement("datalist",{id:"path"},this.props.schematic.pathNames.map((function(e,t){return r.a.createElement("option",{key:t,value:e})}))),"-",r.a.createElement("input",{type:"number",placeholder:"position",onChange:function(t){return e.props.store.updatePathNucPos(e.props.store.getPath(),t.target.value)},style:{width:"80px"}}),r.a.createElement("span",{style:{marginLeft:"2px"}},r.a.createElement("button",{className:"button",onClick:function(){return e.handleJump()}},"Jump"))),r.a.createElement("div",{className:"row"},r.a.createElement("span",null," ","Use Vertical Compression:",r.a.createElement(Z,{store:this.props.store})),r.a.createElement("span",null," ","Row Height:",r.a.createElement(U.a,null,(function(){return r.a.createElement("input",{type:"number",min:1,value:e.props.store.pixelsPerRow,onChange:e.props.store.updateHeight,style:{width:"30px"}})}))),r.a.createElement("span",null," ","Column Width:",r.a.createElement("input",{type:"number",min:1,value:this.props.store.pixelsPerColumn,onChange:this.props.store.updateWidth,style:{width:"30px"}}))))}}]),t}(r.a.Component),Z=function(e){function t(){return Object(c.a)(this,t),Object(u.a)(this,Object(h.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(p.a)(t,[{key:"render",value:function(){var e=this;return r.a.createElement(U.a,null,(function(){return r.a.createElement("input",{type:"checkbox",checked:e.props.store.useVerticalCompression,onChange:e.props.store.toggleUseVerticalCompression})}))}}]),t}(r.a.Component),z=(r.a.Component,r.a.Component,W),D=n(44),J=n.n(D),V=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(u.a)(this,Object(h.a)(t).call(this,e))).layerRef=r.a.createRef(),n.layerRef2=r.a.createRef(null),n.timerHighlightingLink=null,n.timerSelectionLink=null,n.componentDidMount=function(){var e=document.getElementById("button-container").clientHeight;document.getElementsByClassName("konvajs-content")[0].style.position="relative",n.setState({buttonsHeight:e}),n.layerRef.current.getCanvas()._canvas.id="cnvs",n.layerRef.current.getCanvas()._canvas.position="relative",n.layerRef2.current.getCanvas()._canvas.id="arrow",n.layerRef2.current.getCanvas()._canvas.position="relative"},n._updateHighlightedNode=function(e){n.setState({highlightedLink:e}),n.recalcXLayout()},n.updateHighlightedNode=function(e){n.state.selectedLink||(null!=e?(clearTimeout(n.timerHighlightingLink),n.state.highlightedLink!==e&&(n.timerHighlightingLink=setTimeout((function(){n._updateHighlightedNode(e)}),600))):(clearTimeout(n.timerHighlightingLink),null!=n.state.highlightedLink&&(n.timerHighlightingLink=setTimeout((function(){n._updateHighlightedNode(e)}),600))))},n.updateSelectedLink=function(e,t,o){console.log("updateSelectedLink");var r=Object(l.a)(n.props.store.beginEndBin,2),s=r[0],i=r[1],a=!1;s<=t&&o<=i||(console.log("updateSelectedLink - NewBeginEndBin"),n.props.store.updateBeginEndBin(t,o),a=!0),clearTimeout(n.timerHighlightingLink),(e!==n.selectedLink||a)&&(console.log("updateSelectedLink - NewSelection"),n.setState({highlightedLink:e,selectedLink:e})),e&&(console.log("Timer deselection"),clearTimeout(n.timerSelectionLink),n.timerSelectionLink=setTimeout((function(){var e=Object(l.a)(n.props.store.beginEndBin,2),t=e[0],o=e[1];n.updateSelectedLink(null,t,o)}),5e3))},n.renderNucleotidesSchematic=function(){if(!n.props.store.loading&&1===n.props.store.getBinWidth()&&!n.props.store.useWidthCompression&&n.props.store.pixelsPerColumn>=10&&n.schematic.nucleotides.length>0)return n.schematic.components.map((function(e,t){var o=n.schematic.nucleotides.slice(e.firstBin-n.props.store.chunkBeginBin,e.lastBin-n.props.store.chunkBeginBin+1);return r.a.createElement(r.a.Fragment,{key:"nt"+t},r.a.createElement(B,{store:n.props.store,item:e,key:t,height:n.visibleHeightPixels(),width:e.arrivals.length+(n.props.store.useWidthCompression?n.props.store.binScalingFactor:e.num_bin)+(e.departures.length-1),nucleotides:o}))}))},n.updateHighlightedNode=n.updateHighlightedNode.bind(Object(d.a)(n)),n.updateSelectedLink=n.updateSelectedLink.bind(Object(d.a)(n)),n.state={schematize:[],pathNames:[],actualWidth:1,buttonsHeight:0},n.schematic=new j({store:n.props.store}),Object(f.observe)(n.props.store.chunkURLs,n.fetchAllChunks.bind(Object(d.a)(n))),Object(f.observe)(n.props.store,"useVerticalCompression",n.updateSchematicMetadata.bind(Object(d.a)(n))),Object(f.observe)(n.props.store,"useWidthCompression",n.recalcXLayout.bind(Object(d.a)(n))),Object(f.observe)(n.props.store,"useConnector",n.recalcXLayout.bind(Object(d.a)(n))),Object(f.observe)(n.props.store,"pixelsPerColumn",n.recalcXLayout.bind(Object(d.a)(n))),Object(f.observe)(n.props.store,"pixelsPerRow",n.recalcY.bind(Object(d.a)(n))),Object(f.observe)(n.props.store.chunksProcessed,n.updateSchematicMetadata.bind(Object(d.a)(n))),Object(f.observe)(n.props.store,"loading",n.render.bind(Object(d.a)(n))),Object(f.observe)(n.props.store,"chunkIndex",n.openRelevantChunksFromIndex.bind(Object(d.a)(n))),Object(f.observe)(n.props.store,"indexSelectedZoomLevel",n.openRelevantChunksFromIndex.bind(Object(d.a)(n))),Object(f.observe)(n.props.store.beginEndBin,n.openRelevantChunksFromIndex.bind(Object(d.a)(n))),J()(n.props.store),n}return Object(m.a)(t,e),Object(p.a)(t,[{key:"openRelevantChunksFromIndex",value:function(){if(console.log("STEP #3: with new chunkIndex, this.openRelevantChunksFromIndex()"),null!==this.props.store.chunkIndex&&this.props.store.chunkIndex.zoom_levels.keys()){var e=this.props.store.getBeginBin();this.props.store.setAvailableZoomLevels(this.props.store.chunkIndex.zoom_levels.keys());var t=this.props.store.getSelectedZoomLevel(),n=function(e,t,n){for(var o=1920/n.pixelsPerColumn,r=[],s=[],i=e+1,a=0,l=n.chunkIndex.zoom_levels.get(t),c=0;c<l.files.length;c++){var p=l.files[c];if(p.last_bin>=e){var u=p.last_bin-p.first_bin+p.component_count+p.link_count,h=o-a;if(a+=u,r.push(p.file),null!==p.fasta&&s.push(p.fasta),a>o){var d=(p.last_bin-p.first_bin)/u;i=Math.round(h*d);break}}}return[i,r,s]}(e,t,this.props.store),o=Object(l.a)(n,3),r=o[0],s=o[1],i=o[2];console.log([t,r,s,i]);var a="https://collections.lugli.arvadosapi.com/c=lugli-4zz18-urirmr577incm1c/t=2xdu3hljzjkir9dnfn14eyreo6fvfngcihxon7ol8h0r3cc5ot/_/"+this.props.store.jsonName+"/"+t+"/";s=s.map((function(e){return a+e})),i=i.map((function(e){return a+e})),this.props.store.switchChunkFastaURLs(i),this.props.store.switchChunkURLs(s)||this.recalcXLayout()}}},{key:"fetchAllChunks",value:function(){var e=this;if(console.log("STEP #5: once ChunkURLs are listed, go fetchAllChunks"),console.log("fetchAllChunks",this.props.store.chunkURLs),this.props.store.chunkURLs.get(0)){var t=!0,n=!1,o=void 0;try{for(var r,s=function(){var t=r.value;console.log("fetchAllChunks - START reading: "+t),e.schematic.jsonFetch(t).then((function(n){console.log("fetchAllChunks - END reading: "+t),e.schematic.loadJsonCache(t,n)}))},i=this.props.store.chunkURLs[Symbol.iterator]();!(t=(r=i.next()).done);t=!0)s()}catch(a){n=!0,o=a}finally{try{t||null==i.return||i.return()}finally{if(n)throw o}}}else console.warn("No chunk URL defined.")}},{key:"updateSchematicMetadata",value:function(){var e=this;P(this.props.store.chunkURLs,this.props.store.chunksProcessed)&&(console.log("updateSchematicMetadata #components: "+this.schematic.components.length),console.log("STEP #8: chunksProcessed finishing triggers updateSchematicMetadata with final rendering info for this loaded chunks"),this.setState({schematize:this.schematic.components,pathNames:this.schematic.pathNames},(function(){e.recalcXLayout(),e.compressed_row_mapping=function(e){var t=new Set,n=!0,o=!1,r=void 0;try{for(var s,i=e[Symbol.iterator]();!(n=(s=i.next()).done);n=!0){var a=s.value,c=!0,p=!1,u=void 0;try{for(var h,d=a.occupants[Symbol.iterator]();!(c=(h=d.next()).done);c=!0){var m=h.value;t.add(m)}}catch(j){p=!0,u=j}finally{try{c||null==d.return||d.return()}finally{if(p)throw u}}}}catch(j){o=!0,r=j}finally{try{n||null==i.return||i.return()}finally{if(o)throw r}}var g=Array.from(t).sort(),f={},v=!0,y=!1,b=void 0;try{for(var k,x=g.entries()[Symbol.iterator]();!(v=(k=x.next()).done);v=!0){var C=k.value,O=Object(l.a)(C,2),w=O[0];f[O[1]]=w}}catch(j){y=!0,b=j}finally{try{v||null==x.return||x.return()}finally{if(y)throw b}}return f}(e.schematic.components),e.maxNumRowsAcrossComponents=e.calcMaxNumRowsAcrossComponents(e.schematic.components),e.props.store.setLoading(!1)})))}},{key:"recalcXLayout",value:function(){var e=this;console.log("recalcXLayout");var t=!0,n=!1,o=void 0;try{for(var r,s=this.schematic.components.entries()[Symbol.iterator]();!(t=(r=s.next()).done);t=!0){var i=r.value,a=Object(l.a)(i,2),c=a[0],p=a[1];p.relativePixelX=this.leftXStart(p,c,0,0)}}catch(y){n=!0,o=y}finally{try{t||null==s.return||s.return()}finally{if(n)throw o}}var u=this.schematic.components.map((function(t){return t.arrivals.length+(t.departures.length-1)+(e.props.store.useWidthCompression?e.props.store.binScalingFactor:t.lastBin-t.firstBin)+1})).reduce((function(e,t){return e+t}),0),h=this.props.store.pixelsPerColumn*this.schematic.components.length,d=u*this.props.store.pixelsPerColumn+h;this.setState({actualWidth:d});var m=H(this.schematic.components,this.props.store.pixelsPerColumn,this.props.store.topOffset,this.props.store.useWidthCompression,this.props.store.binScalingFactor,this.leftXStart.bind(this)),g=Object(l.a)(m,2),f=g[0],v=g[1];this.distanceSortedLinks=f,this.props.store.updateTopOffset(parseInt(v))}},{key:"recalcY",value:function(){this.setState({highlightedLink:null})}},{key:"calcMaxNumRowsAcrossComponents",value:function(e){var t=e.map((function(e){return e.occupants.length}));return Math.max.apply(Math,Object(a.a)(t))}},{key:"visibleHeightPixels",value:function(){return this.props.store.useVerticalCompression||!this.compressed_row_mapping?(void 0===this.maxNumRowsAcrossComponents&&(this.maxNumRowsAcrossComponents=this.calcMaxNumRowsAcrossComponents(this.schematic.components)),console.log("maxNumRowsAcrossComponents",this.maxNumRowsAcrossComponents),(this.maxNumRowsAcrossComponents+2.5)*this.props.store.pixelsPerRow):(Object.keys(this.compressed_row_mapping).length+.25)*this.props.store.pixelsPerRow}},{key:"leftXStart",value:function(e,t,n,o){return((this.props.store.useWidthCompression?e.columnX+(e.index-this.schematic.components[0].index)*this.props.store.binScalingFactor:e.columnX-this.props.store.beginColumnX-(this.props.store.getBeginBin()-this.props.store.chunkBeginBin-1))+n+o)*this.props.store.pixelsPerColumn+t*this.props.store.pixelsPerColumn}},{key:"renderComponent",value:function(e,t,n){var o=this;return r.a.createElement(r.a.Fragment,null,r.a.createElement(_,{store:this.props.store,item:e,key:"r"+t,height:this.visibleHeightPixels(),widthInColumns:e.arrivals.length+(this.props.store.useWidthCompression?this.props.store.binScalingFactor:e.num_bin)+(e.departures.length-1),compressed_row_mapping:this.compressed_row_mapping,pathNames:n}),e.arrivals.map((function(n,r){return o.renderLinkColumn(e,t,0,r,n)})),e.departures.slice(0,-1).map((function(n,r){var s=e.arrivals.length+(o.props.store.useWidthCompression?o.props.store.binScalingFactor:e.num_bin);return o.renderLinkColumn(e,t,s,r,n)})))}},{key:"renderLinkColumn",value:function(e,t,n,o,s){var i=this.leftXStart(e,t,n,o),a=N(s,this.state.highlightedLink,this.state.selectedLink),c=Object(l.a)(a,3),p=c[0],u=c[1],h=c[2];return r.a.createElement(M,{store:this.props.store,key:"departure"+t+o,item:s,pathNames:this.state.pathNames,x:i,pixelsPerRow:this.props.store.pixelsPerRow,width:this.props.store.pixelsPerColumn,color:p,opacity:u,stroke:h,updateHighlightedNode:this.updateHighlightedNode,compressed_row_mapping:this.compressed_row_mapping})}},{key:"renderLink",value:function(e){var t=N(e.linkColumn,this.state.highlightedLink,this.state.selectedLink),n=Object(l.a)(t,2),o=n[0],s=n[1];return r.a.createElement(A,{store:this.props.store,key:"arrow"+e.linkColumn.key,link:e,color:o,opacity:s,updateHighlightedNode:this.updateHighlightedNode,updateSelectedLink:this.updateSelectedLink})}},{key:"renderSchematic",value:function(){var e=this;if(console.log("renderSchematic"),!this.props.store.loading)return this.schematic.components.map((function(t,n){return r.a.createElement(r.a.Fragment,{key:"f"+n},e.renderComponent(t,n,e.state.pathNames))}))}},{key:"renderSortedLinks",value:function(){var e=this;if(!this.props.store.loading)return this.distanceSortedLinks.map((function(t,n){return e.renderLink(t)}))}},{key:"loadingMessage",value:function(){if(this.props.store.loading)return r.a.createElement(g.Text,{y:100,fontSize:60,width:300,align:"center",text:"Loading..."})}},{key:"render",value:function(){return console.log("Start render"),r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{style:{position:"sticky",top:0,zIndex:"2",background:"white",width:this.state.actualWidth+60,minWidth:"100%"}},r.a.createElement(z,{store:this.props.store,schematic:this.schematic}),r.a.createElement(g.Stage,{x:this.props.store.leftOffset,y:this.props.topOffset,width:this.state.actualWidth+60,height:this.props.store.topOffset},r.a.createElement(g.Layer,{ref:this.layerRef2},this.renderSortedLinks(),this.renderNucleotidesSchematic()))),r.a.createElement(g.Stage,{x:this.props.store.leftOffset,y:-this.props.store.topOffset,width:this.state.actualWidth+60,height:this.visibleHeightPixels()+this.props.store.nucleotideHeight},r.a.createElement(g.Layer,{ref:this.layerRef},this.loadingMessage(),this.renderSchematic())),r.a.createElement(X,{store:this.props.store}))}}]),t}(o.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var q=n(4),Y=q.types.model({file:q.types.string,fasta:q.types.maybeNull(q.types.string),first_bin:q.types.integer,last_bin:q.types.integer,component_count:q.types.integer,link_count:q.types.integer}),K=q.types.model({bin_width:q.types.integer,last_bin:q.types.integer,files:q.types.array(Y)}),G=q.types.maybeNull(q.types.model({json_version:14,pangenome_length:q.types.integer,zoom_levels:q.types.map(K)})),$=q.types.model("PathNucPos",{path:q.types.string,nucPos:q.types.integer}),Q=q.types.model({chunkIndex:G,beginEndBin:q.types.optional(q.types.array(q.types.integer),[1,60]),useVerticalCompression:!1,useWidthCompression:!1,binScalingFactor:3,useConnector:!0,pixelsPerColumn:10,pixelsPerRow:10,leftOffset:0,topOffset:400,highlightedLink:0,maximumHeightThisFrame:150,cellToolTipContent:"",jsonName:"SARS-CoV-b2",availableZoomLevels:q.types.optional(q.types.array(q.types.string),["1"]),indexSelectedZoomLevel:0,chunkURLs:q.types.optional(q.types.array(q.types.string),[]),chunkFastaURLs:q.types.optional(q.types.array(q.types.string),[]),chunksProcessed:q.types.optional(q.types.array(q.types.string),[]),chunkBeginBin:-1,pathNucPos:q.types.optional($,{path:"path",nucPos:0}),pathIndexServerAddress:"http://193.196.29.24:3010/",nucleotideHeight:10,pangenomelast_bin:-1,beginColumnX:0,loading:!0}).actions((function(e){function t(){return e.beginEndBin[0]}function n(){return e.beginEndBin[1]}return{setChunkIndex:function(t){console.log("STEP #2: chunkIndex contents loaded"),console.log("Index updated with content:",t),e.chunkIndex=t},updateBeginEndBin:function(o,r){console.log("updateBeginEndBin - "+o+" - "+r),o=Math.max(1,Math.round(o)),r=Math.max(1,Math.round(r));var s,i,a=t(),l=n();r===l&&(r=o+(l-a)),r<o&&(o=r-1),o!==a?(s=o,i=r,e.beginEndBin=[s,i],console.log("updated begin and end: "+o+" "+r)):e.beginEndBin[1]=r},updateTopOffset:function(t){Number.isFinite(t)&&Number.isSafeInteger(t)&&(e.topOffset=t+10)},updateHighlightedLink:function(t){e.highlightedLink=t},updateMaxHeight:function(t){e.maximumHeightThisFrame=Math.max(e.maximumHeightThisFrame,t)},resetRenderStats:function(){e.maximumHeightThisFrame=1},updateCellTooltipContent:function(t){e.cellToolTipContent=String(t)},updateBinScalingFactor:function(t){var n=t.target.value;e.binScalingFactor=Math.max(1,Number(n))},toggleUseVerticalCompression:function(){e.useVerticalCompression=!e.useVerticalCompression},toggleUseWidthCompression:function(){e.useWidthCompression=!e.useWidthCompression},toggleUseConnector:function(){e.useConnector=!e.useConnector},updateHeight:function(t){e.pixelsPerRow=Math.max(1,Number(t.target.value))},updateWidth:function(t){e.pixelsPerColumn=Number(t.target.value)},tryJSONpath:function(t){k("https://collections.lugli.arvadosapi.com/c=lugli-4zz18-urirmr577incm1c/t=2xdu3hljzjkir9dnfn14eyreo6fvfngcihxon7ol8h0r3cc5ot/_/"+t.target.value+"/bin2file.json")&&(console.log("STEP#1: New Data Source: "+t.target.value),e.jsonName=t.target.value)},switchChunkURLs:function(t){return!P(t,e.chunkURLs)&&(console.log("STEP #4: Set switchChunkURLs: "+t),e.chunkURLs=t,e.chunksProcessed=[],!0)},switchChunkFastaURLs:function(t){P(t,e.chunkFastaURLs)||(console.log("STEP #4.fasta: Set switchChunkFastaURLs: "+t),e.chunkFastaURLs=t)},addChunkProcessed:function(t){console.log("STEP #7: processed "+t),e.chunksProcessed.push(t)},getBeginBin:t,getEndBin:n,updatePathNucPos:function(t,n){n=n?parseInt(n):0,e.pathNucPos={path:t,nucPos:n}},setBeginColumnX:function(t){e.beginColumnX=t},setChunkBeginBin:function(t){e.chunkBeginBin=t},getBinWidth:function(){return Number(e.getSelectedZoomLevel())},getSelectedZoomLevel:function(){var t=e.availableZoomLevels[e.indexSelectedZoomLevel];return t||"1"},setIndexSelectedZoomLevel:function(t){e.indexSelectedZoomLevel=t},setAvailableZoomLevels:function(t){var n=Object(a.a)(t);e.availableZoomLevels=n},setLoading:function(t){e.loading=t}}})).views((function(e){return{}})).create({});i.a.render(r.a.createElement(V,{store:Q}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))},45:function(e,t,n){e.exports=n(101)},49:function(e,t,n){},95:function(e,t,n){}},[[45,1,2]]]);
//# sourceMappingURL=main.7f01cbba.chunk.js.map